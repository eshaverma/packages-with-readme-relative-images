<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Test</title><style>*{box-sizing:border-box}.cxs-display-table{display:table}.cxs-291348840 pre .hljs-number{color:#00bd78}.cxs-3954183383{font-size:24px}.cxs-291348840 a:hover{color:#ee5544}.cxs-4066908388{clear:both}.cxs-799160745{font-size:48px}.cxs-1246195080{margin-left:-8px;margin-right:-8px}.cxs-291348840{font-size:20px;line-height:1.625}.cxs-291348840 h1{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:48px;margin-top:48px;margin-bottom:8px}.cxs-291348840 h2{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:24px;margin-top:48px;margin-bottom:8px}.cxs-291348840 h3{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:20px;margin-top:48px;margin-bottom:8px}.cxs-291348840 h4{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:16px;margin-top:32px;margin-bottom:8px}.cxs-291348840 h5{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:14px;margin-top:32px;margin-bottom:8px}.cxs-291348840 h6{font-weight:400;text-transform:uppercase;letter-spacing:0.1em;font-size:12px;margin-top:32px;margin-bottom:8px}.cxs-291348840 p{overflow-x:auto;font-size:20px;margin-top:0px;margin-bottom:16px}.cxs-291348840 code{font-family:Menlo, monospace;font-size:14px;color:#005499}.cxs-291348840 pre{font-family:Menlo, monospace;font-size:14px;overflow-x:auto;padding-left:16px;margin-top:8px;margin-bottom:32px;border-left:2px solid #ddd}.cxs-291348840 pre .hljs-keyword{color:#ee5544}.cxs-291348840 pre .hljs-built_in{color:#005499}.cxs-291348840 pre .hljs-type{color:#005499}.cxs-291348840 pre .hljs-literal{color:#ee5544}.cxs-291348840 a{color:inherit}.cxs-291348840 pre .hljs-regexp{color:#ee5544}.cxs-291348840 pre .hljs-string{color:#005499}.cxs-291348840 pre .hljs-subst{color:#005499}.cxs-291348840 pre .hljs-symbol{color:#ee5544}.cxs-291348840 pre .hljs-class{color:#ee5544}.cxs-291348840 pre .hljs-function{color:#00bd78}.cxs-291348840 pre .hljs-title{color:#ee5544}.cxs-291348840 pre .hljs-params{color:#005499}.cxs-291348840 pre .hljs-comment{color:#005499}.cxs-291348840 pre .hljs-doctag{color:#005499}.cxs-291348840 pre .hljs-meta{color:#005499}.cxs-291348840 pre .hljs-meta-keyword{color:#ee5544}.cxs-291348840 pre .hljs-meta-string{color:#ee5544}.cxs-291348840 hr{margin-top:48px;margin-bottom:48px;border:0px;border-bottom:2px solid #ddd}.cxs-291348840 table{border-collapse:separate;border-spacing:0px;max-width:100%;width:100%}.cxs-291348840 th{text-align:left;line-height:inherit;vertical-align:bottom}.cxs-291348840 td{vertical-align:top;line-height:inherit}.cxs-291348840 img{max-width: 100%;height: auto;margin-top:16px;margin-bottom:16px}.cxs-291348840 ul{padding-left:32px;margin-top:0px;margin-bottom:16px}@media screen and (min-width: 52em) { .cxs-799160745{font-size:72px} }@media screen and (min-width: 52em) { .cxs-3954183383{} }</style></head><body style="margin:0;"><div class="Xv" style="font-family:Athelas, Georgia, serif;font-weight:400;line-height:1.5;color:#121212;background-color:#fff;"><nav style="display:flex;align-items:center;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;background-color:#fff;"><a href="https://github.com/code-therapy/packages-with-readme-relative-images" class="Link" style="box-sizing:border-box;color:inherit;display:inline-block;font-size:14px;line-height:16px;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:16px;font-weight:600;text-decoration:none;">GitHub</a><a href="https://npmjs.com/package/@code-therapy/packages-with-readme-relative-images" class="Link" style="box-sizing:border-box;color:inherit;display:inline-block;font-size:14px;line-height:16px;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:16px;font-weight:600;text-decoration:none;">npm</a></nav><header class="BannerHeader" style="display:flex;align-items:center;justify-content:center;text-align:left;min-height:100vh;color:#121212;background-color:#f3f3f3;background-image:url(undefined);background-size:cover;background-position:center;"><div style="box-sizing:border-box;width:100%;max-width:768px;margin-left:auto;margin-right:auto;padding-top:48px;padding-bottom:48px;padding-left:32px;padding-right:32px;"><h1 class="cxs-799160745" style="box-sizing:border-box;font-weight:400;text-transform:uppercase;letter-spacing:0.1em;margin:0;">packages-with-readme-relative-images</h1><h2 class="cxs-3954183383" style="box-sizing:border-box;font-weight:400;text-transform:uppercase;letter-spacing:0.1em;margin:0;">The time you included that image in your README.md from a relative path on GitHub and then published to NPM!</h2><p class="Text" style="box-sizing:border-box;font-size:20px;margin:0;">v0.0.5</p><div class="cxs-1246195080" style="box-sizing:border-box;padding-top:16px;padding-bottom:16px;"><iframe src="https://platform.twitter.com/widgets/tweet_button.html?text=packages-with-readme-relative-images%3A%20The%20time%20you%20included%20that%20image%20in%20your%20README.md%20from%20a%20relative%20path%20on%20GitHub%20and%20then%20published%20to%20NPM!&amp;url=&amp;via=&amp;hashtags=&amp;size=" height="20" allowtransparency="true" frameborder="0" scrolling="no" style="box-sizing:border-box;width:61px;overflow:hidden;margin:8px;"></iframe><iframe src="https://ghbtns.com/github-btn.html?type=star&amp;count=true&amp;user=code-therapy&amp;repo=packages-with-readme-relative-images&amp;size=" height="20" frameborder="0" scrolling="no" style="box-sizing:border-box;width:100px;overflow:hidden;margin:8px;"></iframe><div class="cxs-4066908388 cxs-display-table"></div></div></div></header><div class="cxs-291348840" style="box-sizing:border-box;max-width:768px;margin-left:auto;margin-right:auto;padding-top:32px;padding-bottom:32px;padding-left:32px;padding-right:32px;"><article style="box-sizing:border-box;"><div><h1>Publishing a README using relative image paths from GitHub to NPM!</h1>
<hr />
<p><strong>SOLVED:</strong> A previous solution that made it possible to render SVG files on
GitHub (using relative URLs) seems to work on raw.githubusercontent.com by
making it correctly set the Content-Type. So, in order to render SVG images that
use relative paths in markdown and have them render properly on NPM &amp; Yarn, you
simply have to append this query to your relative path: <code>?sanitize=true</code>.</p>
<hr />
<p><strong>UPDATE:</strong> <em>Images have been updated to show the difference between unsanitized and
sanitized (adding <code>?sanitize=true</code>) for svg images with relative &amp; absolute URLs
served from GitHub.</em></p>
<hr />
<h2><strong>Chapter 1:</strong> Authoring</h2>
<p>In GitHub-Flavoured Markdown (GFM), when you want to include an image using its
relative path you do either this:</p>
<blockquote>
<p>An <em>inlined</em> image:</p>
<pre>![<span class="hljs-string">description of the image</span>](<span class="hljs-link">relative/path/to/image.ext</span>)</pre></blockquote>
<p>or this:</p>
<blockquote>
<p>A <em>referenced</em> image with a relative path:</p>
<pre>![<span class="hljs-string">description of the image</span>][<span class="hljs-symbol">asset-1</span>]</pre><p>Where somewhere in the file (not sure if the order is a factor):</p>
<pre>[<span class="hljs-symbol">asset-1</span>]: <span class="hljs-link">relative/path/to/image.ext</span></pre></blockquote>
<p>Both GitHub and VSCode will resolve those paths relative to the markdown source
path. So if you've been down this path, you, myself included, might have
concluded that this is the behaviour to be expected when using relative paths
in GFM.</p>
<p>But then you try to figure out how to reference a particular branch or commit
for your assets, and things start going insane, and you might have decided to
cut your losses just to keep things simple, as I did. Sparing details, you are
essentially choosing between hard-linked githubusercontent or rawgit URLs which
don't fork or relative paths and maybe subtrees and those fork ugly but fork.</p>
<p>So between relative and absolute, you would naturally opt for relative and you
repeat this to yourself a few times so that it sticks, before moving on:</p>
<blockquote>
<p>I promise to only use relative paths from now on!</p>
</blockquote>
<h2><strong>Chapter 2:</strong> Publishing</h2>
<p>Now you have your package all cooked up and ready to go and fire this:</p>
<pre><span class="hljs-built_in">npm</span> publish</pre><p>or that:</p>
<pre><span class="hljs-attribute">yarn publish</span></pre><p>Sweet, right… not when you get something like:</p>
<blockquote>
<p>you are awesome but does your package really work if you can't even get the
damn thing to render correctly on npm and yarn! <em>maybe you should stick to
your day job</em> and <strong>I will go ahead and use that other one that looks right</strong></p>
</blockquote>
<p>Yes, that is what you will eventually be thinking that people are thinking when
they look at your broken README.md on both Yarn &amp; NPM (as of this moment),
because not all images will render like this and we will see why in a bit.</p>
<p>But you figure it has to be that relative paths are being resolved relative to
yarnpkg.com or npm.com and that is an okay assumption, dead-wrong but okay, but
honestly, those guys do a lot of work trying to get your relative stuff to be
as relative as if they were on GitHub's own rendering. Sadly, this last portion
takes a lot of investigating to appreciate, and like me, I think you just want
to keep some of your remaining sanity rid yourself of relative paths and opt for
absolute paths (what could go wrong there aside from the obvious).</p>
<p>So you if you opt to remain relativly sane-minded like myself most of the time,
you repeat this to yourself a few times, before moving on:</p>
<blockquote>
<p>I promise to only use absolute paths from now on!</p>
</blockquote>
<h2><strong>Chapter 3:</strong> Republishing</h2>
<p>Wow, it haz downloadz for a few days in a row, and you even start getting that
awesome feeling when someone files their first issue:</p>
<blockquote>
<p><em>User:</em></p>
<blockquote>
<p>It is broken, and I hate you.</p>
</blockquote>
<p><em>You:</em></p>
<blockquote>
<p>I love you so much, how can I make you happier.</p>
</blockquote>
<p><em>User:</em></p>
<blockquote>
<p>Fix that shim or polyfill it up your stack</p>
</blockquote>
<p><em>You:</em></p>
<blockquote>
<p>I see. And how does that make you feel? Did you try this …</p>
</blockquote>
<p><em>User:</em></p>
<blockquote>
<p>Mother-bugger, people need to know that, here is a patch (aka pull-request).</p>
</blockquote>
<p><em>You:</em></p>
<blockquote>
<p>Oh, I see, you are healing by helping others, I will follow that. Merged!</p>
</blockquote>
<p><em>User:</em></p>
<blockquote>
<p>Mother-bugger, what happened to my figures?</p>
</blockquote>
<p><em>You:</em></p>
<blockquote>
<p>Mother-bugger, I've seen that before, let's stick to absolute paths (again).</p>
</blockquote>
</blockquote>
<p>So you decide to learn from this, and you repeat this to yourself a few times,
before moving on:</p>
<blockquote>
<p>I promise to only use text from now on, maybe html-served links, but my docs
will be as bland and possible and if anyone touches my assets I will have them
arrested.</p>
</blockquote>
<h2><strong>Reflection:</strong></h2>
<p><em>Quick Comparison: </em></p>
<blockquote>
<table>
<thead>
<tr>
<th></th>
<th>Relative SVG <em>fixed</em></th>
<th>Relative PNG</th>
<th>Absolute SVG <em>fixed</em></th>
<th>Absolute PNG</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Referenced</em></td>
<td><img src="image.svg?sanitize=true" /></td>
<td><img src="image.png" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg?sanitize=true" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" /></td>
</tr>
<tr>
<td><em>Inlined unsanitized</em></td>
<td><img src="image.svg" /></td>
<td><img src="image.png" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" /></td>
</tr>
<tr>
<td><em>Inlined sanitized</em></td>
<td><img src="image.svg?sanitize=true" /></td>
<td><img src="image.png" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg?sanitize=true" /></td>
<td><img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" /></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<p>Some might say that the problem is that you are using SVG, but that would be a
little embarrasing to say out loud!</p>
<p>Some people may eventually hate that last bit and decide to do some mindfulness
and reflection, and I happen to be one of those people.</p>
<p>Here is <a href="https://github.com/npm/marky-markdown/blob/3cf46914cfc3a8b20847b3c190862239dbe0ba45/lib/plugin/github.js#L8-L13">what npm does (aka marky-markdown)</a>:</p>
<pre><span class="hljs-keyword">var</span> DEFAULT_REF = <span class="hljs-string">'HEAD'</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildImageUrl</span> (<span class="hljs-params">repository, url</span>) </span>{
  <span class="hljs-keyword">var</span> prefix = <span class="hljs-string">'https://raw.githubusercontent.com/'</span>
  <span class="hljs-keyword">return</span> prefix + path.join(repository.user, repository.repo, DEFAULT_REF, url.href)
}</pre><p>Here is <a href="https://github.com/yarnpkg/website/blob/e155b85428e5ebed5eec9302a5179e47486dc07c/js/src/lib/Details/Markdown.js#L7-L42">what yarn does (aka yarnpkg/website)</a>:</p>
<pre><span class="hljs-keyword">const</span> GITHUB = {
    <span class="hljs-attr">main</span>: <span class="hljs-string">'https://github.com'</span>,
    <span class="hljs-attr">raw</span>: <span class="hljs-string">'https://raw.githubusercontent.com'</span>,
};

<span class="hljs-comment">/* … then … */</span>

<span class="hljs-keyword">const</span> { user, project, path, head } = githubRepo
<span class="hljs-keyword">const</span> prefix = <span class="hljs-function">(<span class="hljs-params">href, base</span>) =&gt;</span>
    <span class="hljs-comment">// prefixURL is a util function that does what it sounds like it does.</span>
    prefixURL(href, { base, user, project, <span class="hljs-attr">head</span>: head ? head : <span class="hljs-string">'master'</span>, path, });

<span class="hljs-comment">/* … then … */</span>

renderer.image = <span class="hljs-function">(<span class="hljs-params">href, title, text</span>) =&gt;</span>
    <span class="hljs-string">`&lt;img src=&quot;<span class="hljs-subst">${prefix(href, GITHUB.raw)}</span>&quot; title=&quot;<span class="hljs-subst">${title}</span>&quot; alt=&quot;<span class="hljs-subst">${text}</span>&quot;/&gt;`</span>;</pre><p>Remember that mindfulness is not about judging, only recognizing the strong
emotions that this had elicited and sitting with them knowing it is okay before
letting them go to move on. <strong>Sure, enough of that, thanks, time for action.</strong></p>
<h2><strong>Conclusion:</strong></h2>
<ul>
<li><p><strong>NPM &amp; Yarn:</strong> take your relative URLs and they have no clue which git reference
they resolve from, whereas GitHub knows.*</p>
</li>
<li><p><strong>Yarn:</strong> uses algolia to get your package's raw README markdown in a more
glorified <code>package.json</code>-like XHR response, then to head or not-to-head, all
done client-side and very efficiently in my experience, which is nothing
short of facinating.</p>
<p>An advantage of having it on the client-side here is that you can actively
participate in <a href="https://github.com/yarnpkg/website/issues/685">debugging and resolving your own issue</a>
instead of waiting till someone can actually play around with the code-base
in some test branch until they can reproduce the issue and isolate the bug
going only what they can fathom from what you could deem important to them.</p>
</li>
<li><p><strong>NPM:</strong> uses own backend to prerender your README using marky-markdown, and
to be honest, there is more to what markey does than I let on, including a
plugin to use cdn when resolving relative images, but there is no way to tell
if that plugin is used in production until I encounter such an image (but
none so far for me).</p>
<p>Server-side here can be a simple act of generousity and sense of community
since it takes the load off client-side where caching can really be a benefit
but there is also the fact that this is the actual registry, and one would
expect that the registry itself should be the source of the one consistent
truth on anything in the registry.</p>
</li>
<li><p><strong>GitHub:</strong> seems to not have a one-size strategy when serving files from
<code>raw.githubusercontent.com</code>, treating <a href="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png">PNG as <code>image/png</code></a>
and <a href="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg?sanitize=true">SVG as 'text/plain'</a> as this should prevent potential
malicious content from executing client-side, or so becomes the rhetoric.</p>
<p>While there is an idea that GitHub simply wants to discourage people from
overloading repos with production requests of live content, consider the fact
that a PNG is most likely going to be larger than a well-formed SVG, and that
its footprint grows exponentially with it's dimensions. You avoid this in
production because GitHub is in the repo business, not a CDN.</p>
</li>
<li><p><strong>RawGit:</strong> if you accept the practical limitations on uptime that comes with
the fact that this is an awesome free service that doing it's best effort,
you can get properly MIME-typed files but to use them, you currently need
absolute URLs to work across the board (until it doesn't).</p>
<p>There is magic in how RawGit, a true CDN service, helps you split-hairs when
deciding on the URL that best resolves to an asset across its history which
can also be <strong>permanently</strong> cached (as it should) for production when served
from <code>cdn.rawgit.com/…</code> versus <code>rawgit.com/…</code>. Those are functionally two
very different services that cover most production and development scenarios.</p>
<blockquote>
<p>|                       |      SVG     |      PNG     |
|:----------------------|:------------:|:------------:|
| raw.githubusercontent <em>unsanitized</em> | <img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg" />  | <img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" />  |
| raw.githubusercontent <em>sanitized</em> | <img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg?sanitize=true" />  | <img src="https://raw.githubusercontent.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" />  |
| rawgit                | <img src="https://rawgit.com/code-therapy/packages-with-readme-relative-images/HEAD/image.svg" /> | <img src="https://rawgit.com/code-therapy/packages-with-readme-relative-images/HEAD/image.png" /> |
| cdn.rawgit            | <img src="https://cdn.rawgit.com/code-therapy/packages-with-readme-relative-images/636b6b8616eed31d6333ce98aa414ccd9a47b477/image.svg" /> | <img src="https://cdn.rawgit.com/code-therapy/packages-with-readme-relative-images/636b6b8616eed31d6333ce98aa414ccd9a47b477/image.png" /> |
|                       |              |              |</p>
</blockquote>
<p><strong>Note:</strong> Just keep in mind that if you overtax them, you will be throttled or
even banned (ie no more content served from repos under from your user or
organization.</p>
</li>
<li><p><strong>You:</strong> Maybe file an issue, write a post, or pick absolute, or stick with
relative paths… Nope, I just need a warm bath and maybe my next project will
not even require a README :)</p>
</li>
</ul>
</div></article></div><footer><div style="box-sizing:border-box;max-width:768px;margin-left:auto;margin-right:auto;margin-bottom:32px;padding-top:8px;padding-bottom:8px;padding-left:32px;padding-right:32px;"><div style="margin-left:-16px;margin-right:-16px;"><a href="https://github.com/code-therapy/packages-with-readme-relative-images" class="Link" style="box-sizing:border-box;color:inherit;display:inline-block;font-size:14px;line-height:16px;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:16px;font-weight:600;text-decoration:none;">GitHub</a><a href="https://github.com/code-therapy" class="Link" style="box-sizing:border-box;color:inherit;display:inline-block;font-size:14px;line-height:16px;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:16px;font-weight:600;text-decoration:none;">code-therapy</a></div><div></div></div></footer></div><div style="font-family:-apple-system, sans-serif;font-size:12px;font-weight:600;text-align:right;padding:24px;color:#333;background-color:#eee;"><a href="http://compositor.io" style="color:inherit;text-decoration:none;">Built with Compositor.io</a></div></body></html>